# 1. Required packages ----

library(tidyverse) # Core tidyverse packages

dataset <- "0168" # Define the dataset_id

# 2. Import, standardize and export the data ----

read_csv("data/01_raw-data/benthic-cover_paths.csv") %>% 
  filter(datasetID == dataset) %>% 
  select(data_path) %>% 
  pull() %>% 
  readRDS(.) %>% 
  mutate(organismID = coalesce(speciesName, subcategory, category)) %>% 
  select(location, decimalLatitude, decimalLongitude, eventYear, eventMonth, eventDay, eventDate,
         transect, quadrant, maximumDepthInMeters, samplingProtocol, organismID, coverPercentage) %>% 
  rename(locality = location, year = eventYear, month = eventMonth, day = eventDay, parentEventID = transect, eventID = quadrant,
         verbatimDepth = maximumDepthInMeters, measurementValue = coverPercentage) %>% 
  group_by(locality, decimalLatitude, decimalLongitude, year, month, day, eventDate) %>% 
  mutate(parentEventID = as.numeric(as_factor(parentEventID))) %>% 
  ungroup() %>% 
  group_by(locality, decimalLatitude, decimalLongitude, year, month, day, eventDate, parentEventID) %>% 
  mutate(eventID = as.numeric(as_factor(eventID))) %>% 
  ungroup() %>% 
  mutate(samplingProtocol = case_when(samplingProtocol == "12 quadrants with a 10x10 grid per transect" ~ "Photo-quadrat",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                      samplingProtocol == "Transects with 12 quadrants 10x10" ~ "Photo-quadrat",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                      samplingProtocol == "PIT 30 points per transect" ~ "Point intersect transect",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                      samplingProtocol == "PIT 30 points" ~ "Point intersect transect",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                      samplingProtocol == "Para estudiar la cobertura de coral vivo en los arrecifes y comunidades coralinas,  se realizarán observaciones cualitativas y cuantitativas mediante transectos permanentes por profundidad, siempre y cuando las condiciones del sitio lo permitan. Los transectos consistirán en colocar una cuadrícula de PVC de 1 m2, subdividida en cuadrículas de 0.01 m2, a lo largo de un transecto paralelo a la costa de 10 m de largo medidos con una cinta métrica (Weinberg 1981). Se muestrean diez cuadrantes a lo largo de cada transecto colocando la cuadricula sucesivamente a lo largo de la cinta métrica sin dejar espacios entre ellas. En cada zona de profundidad se realizarán 3 transectos (3 transectos x 10 m largo x 1 m ancho = 30 m2) paralelos a la costa separados por 10 m entre ellos. En caso de ser muy estrecha la plataforma, se realizarán transectos solamente en el rango entre 3 y 6 m de profundidad y en la base del arrecife. Para cada colonia o tipo de cobertura en la cuadrícula, se registra el taxón (a nivel de especie, cuando sea posible), el área que ocupa contando las celdas y fracciones de una celda. Las categorías de sustrato son: coral vivo  ( a nivel de especie), coral muerto, coral blanco, arena, macroalgas (a nivel de género), tapete algal o turf, algas calcáreas costrosas, cianobacteria, esponja, anemona, rodolitos." ~ "Photo-quadrat", 
                                      samplingProtocol == "Para estudiar la cobertura de coral vivo en los arrecifes y comunidades coralinas,  se realizarán observaciones cualitativas y cuantitativas mediante transectos permanentes por profundidad, siempre y cuando las condiciones del sitio lo permitan. Los transectos consistirán en colocar una cuadrícula de PVC de 1 m2, subdividida en cuadrículas de 0.01 m2, a lo largo de un transecto paralelo a la costa de 10 m de largo medidos con una cinta métrica (Weinberg 1981). Se muestrean diez cuadrantes a lo largo de cada transecto colocando la cuadricula sucesivamente a lo largo de la cinta métrica sin dejar espacios entre ellas. En cada zona de profundidad se realizarán 3 transectos (3 transectos x 10 m largo x 1 m ancho = 30 m2) paralelos a la costa separados por 10 m entre ellos. En caso de ser muy estrecha la plataforma, se realizarán transectos solamente en el rango entre 3 y 6 m de profundidad y en la base del arrecife. Para cada colonia o tipo de cobertura en la cuadrícula, se registra el taxón (a nivel de especie, cuando sea posible), el área que ocupa contando las celdas y fracciones de una celda. Las categorías de sustrato son: coral vivo  ( a nivel de especie), coral muerto, coral blanco, arena, macroalgas (a nivel de género), tapete algal o turf”, algas calcáreas costrosas, cianobacteria, esponja, anemona, rodolitos." ~ "Photo-quadrat",
                                      samplingProtocol == "quadrant sampling" ~ "Photo-quadrat",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                      samplingProtocol == "PIT" ~ "Point intersect transect",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                      samplingProtocol == "quadrant sampling 81 points" ~ "Photo-quadrat",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                      samplingProtocol == "quadrant 64 squares" ~ "Photo-quadrat",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                      samplingProtocol == "photo transects" ~ "Photo-quadrat",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                      samplingProtocol == "PIT every 25cm" ~ "Point intersect transect",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                      samplingProtocol == "Underwater Visual Census" ~ "Visual census",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                      samplingProtocol == "continuous chain transect" ~ "Chain transect",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                      samplingProtocol == "Método de monitoreo: La obtención de datos fue siguiendo el método de monitoreo estandarizado para arrecifes del Pacífico mexicano, el cual consiste de censos visuales en cinco transectos de  banda (25x1m), dispuestos paralelos a la costa en cada sitio (estación de monitoreo), en cada transecto la cobertura de los grupos bentónicos (en %) se estima in situ utilizando seis marcos cuadrados (1m2) dividido en 100 celdas de 10x10cm, que representan el 1% del área total de marco cuadrado, distribuidos equidistantemente a lo largo del transecto de 25m de largo." ~ "Photo-quadrat",
                                      TRUE ~ NA_character_),
         datasetID = dataset) %>% 
  write.csv(., file = paste0("data/02_standardized-data/", dataset, ".csv"), row.names = FALSE)
